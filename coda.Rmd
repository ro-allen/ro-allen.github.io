---
title: "Compositional Data Analysis"
---
Analysis of high-throughput sequencing data (e.g. 16S amplicon sequencing, RNA-seq, metagenomics, metatranscriptomics) is complicated by the fact that these data are invariably compositional. This is the case because sequencing technologies (e.g. *Illumina MiSeq*) return an arbritrary number of reads per sample. Subsequently, these data only hold valuable information about the relative composition of samples, not absolute abundances. Compositional data do not lend themselves well to classical statistical analyses, as these data violate assumptions of independence (Fig. 1). Fortunately, a range of compositional analyses are currently available for handling high-throughput sequencing data. For a brief introduction to the challenge of compositionality in high-throughput sequencing data, see [Microbiome Datasets Are Compositional: And This Is Not Optional](https://www.frontiersin.org/articles/10.3389/fmicb.2017.02224/full).  
<p>&nbsp;</p>

```{r, echo=FALSE, eval=TRUE, message=FALSE, fig.width=15, fig.height=5, fig.cap=paste("<font size=2><b>Figure 1.</b> An illustration of the lack of idenpendence between features in high throughput sequencing data. <b>A:</b> The true abundance of each ASV in each condition. <b>B:</b> The proportion of each ASV in each condition. When dealing with proportional data, it appears that ASV 2-9 are less abundant in the treatment condition compared to the control condition. In reality the true abundances are identical. This occurs as the increased abundance of ASV 1 in the treatment condition incidentally reduces the proportion of reads attributed to ASV 2-9.</font>")}
library(ggplot2)
library(cowplot)

rx = matrix(nrow = 9, ncol = 2)
rx[,1] = 10
rx[,2] = 10
rx[1,2] = 20
rd = as.data.frame(rx)
rd = lapply(rd, function(x) x/sum(x))
rv = cbind(rd$V1, rd$V2)
rv = as.vector(as.matrix(rv))
rvd = as.data.frame(rv)
rvd$Condition = c(rep("Control",9), rep("Treatment", 9))
rvd$species = c("ASV 1", "ASV 2", "ASV 3", "ASV 4", "ASV 5", "ASV 6", "ASV 7", "ASV 8", "ASV 9","ASV 1", "ASV 2", "ASV 3", "ASV 4", "ASV 5", "ASV 6", "ASV 7", "ASV 8", "ASV 9")

ra = matrix(nrow = 9, ncol = 2)
ra[,1] = 10
ra[,2] = 10
ra[1,2] = 20
ra = as.data.frame(ra)
rva = cbind(ra[1], ra[2])
rva = as.vector(as.matrix(rva))
rva = as.data.frame(rva)
rva$Condition = c(rep("Control",9), rep("Treatment", 9))
rva$species = c("ASV 1", "ASV 2", "ASV 3", "ASV 4", "ASV 5", "ASV 6", "ASV 7", "ASV 8", "ASV 9", "ASV 1", "ASV 2", "ASV 3", "ASV 4", "ASV 5", "ASV 6", "ASV 7", "ASV 8", "ASV 9")



p1 = ggplot(rvd, aes(species, rv, fill = Condition)) + geom_bar(stat = "identity", position = "dodge") + theme_bw() + ylab("Proportion") + xlab("Amplicon Sequence Variant") + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.2)) + 
  scale_fill_manual(values = c("skyblue2", "darkblue"))

p2 = ggplot(rva, aes(species, rva, fill = Condition)) + geom_bar(stat = "identity", position = "dodge") + theme_bw() + ylab("Abundance") + xlab("Amplicon Sequence Variant") + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 21)) + 
  scale_fill_manual(values = c("skyblue2", "darkblue"))

plot_grid(p2, p1, labels = c('A', 'B'))
```
<p>&nbsp;</p>
Below, I provide an introduction to compositional beta-diversity and differential abundance anaylses of high throughput sequencing data in R, using Aitchison's distance based PERMANOVA ([Vegan](https://cran.r-project.org/web/packages/vegan/index.html) *adonis* function) and [ALDEx2](https://bioconductor.org/packages/release/bioc/html/ALDEx2.html) respectively. The input data are structured as a phyloseq object. Note that the optimal analytical approach depends on the data in question. 

